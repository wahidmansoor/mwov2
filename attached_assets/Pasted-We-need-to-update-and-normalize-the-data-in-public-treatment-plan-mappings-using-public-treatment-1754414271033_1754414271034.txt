We need to update and normalize the data in `public.treatment_plan_mappings` using `public.treatment_plan_criteria` as a reference, and align all treatment entries with current NCCN, ASCO, and ESMO guidelines.

## âœ… Required Modifications

### 1. **Biomarker Normalization**
Standardize biomarker terminology across all records:
- `"EGFR Exon 19 del"` â†’ `"EGFR Exon 19 Deletion"`
- `"BRCA1/2 mut"` â†’ replace with both `"BRCA1 Mutation"` and `"BRCA2 Mutation"`
- `"BRCA wt"` â†’ replace with `"BRCA Wildtype"` (create this label if needed)

---

### 2. **Histology Validation (based on cancer type)**
Using `public.treatment_plan_criteria` as the reference table:
- Check whether the `histology` assigned to each `cancer_type` is clinically valid.
- Correct incorrect values. Example:
  - **Melanoma** must not use `"Adenocarcinoma"`; replace with `"Melanoma"` if mismatched.
  - **Breast Cancer** should use histologies like `"Invasive Ductal Carcinoma"` or `"Invasive Lobular Carcinoma"`.

---

### 3. **Performance Status Defaults**
In `public.treatment_plan_mappings`, if any of the following are `null`:
- `performance_status_min`
- `performance_status_max`

Then default to:
- `performance_status_min = 0`
- `performance_status_max = 2`

This aligns with eligibility for most systemic therapies per NCCN.

---

### 4. **Guideline-Based Review Flags**

#### 4.1 KRAS G12C 1st-Line NSCLC
- If `biomarkers` includes `"KRAS G12C"` AND `line_of_treatment` is `"1st Line"`:
  - Add field: `"review_flag": "Review 1st Line KRAS G12C â€“ not yet guideline-approved frontline"`

#### 4.2 MSI-H with Oxaliplatin in Adjuvant CRC
- If:
  - `cancer_type` = `"Colorectal Cancer"`
  - `biomarkers` includes `"MSI-H"`
  - `treatment_intent` = `"Adjuvant"`
  - `treatment_protocol` includes `"oxaliplatin"` (case-insensitive)
- Then add:
  - `"review_flag": "Caution: MSI-H patients may not benefit from oxaliplatin in adjuvant CRC"`

#### 4.3 Pancreatic Cancer BRCA Mutation â€“ Missing Maintenance
- If:
  - `cancer_type` = `"Pancreatic Cancer"`
  - `biomarkers` includes `"BRCA1 Mutation"` or `"BRCA2 Mutation"`
  - `treatment_protocol` does **not** mention `"Olaparib"`
- Then add:
  - `"maintenance_suggestion": "Add Olaparib maintenance (per POLO trial) for BRCA+ pancreatic cancer"`

---

### 5. **Audit Notes**
Add a field `"auto_notes"` to each treatment entry that summarizes:
- Which fields were modified
- What clinical flags or suggestions were applied

This will help us trace updates in future reviews.

---

## ðŸ“¤ Output

- Return the **updated `public.treatment_plan_mappings` dataset** as valid JSON.
- Do not alter the `public.treatment_plan_criteria` data (use it for validation only).
- Preserve all original fields unless modified by instruction.
- Sort `biomarkers` alphabetically if changes are made.
- Ensure the output can be used to overwrite the existing `public.treatment_plan_mappings` table via `COPY`, `INSERT`, or ORM migration logic.

---

Let me know if any fields from `public.treatment_plan_criteria` are missing or ambiguous while performing the validation logic.
